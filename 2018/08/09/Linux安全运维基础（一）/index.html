<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Linux," />





  <link rel="alternate" href="/atom.xml" title="Plus Ultra" type="application/atom+xml" />






<meta name="description" content="（一）Linux入门（常见命令 用户权限与管理等）标签（空格分隔）： Linux安全运维基础  [TOC] 1 虚拟机的使用创建虚拟机磁盘：虚拟机中文件形式存在（镜像文件）ifconfig 查看设置网络配置：vnet8，桥接模式vnet1：仅宿主机模式 2 操作系统概念内存，寻址空间，平面寻址，三维寻址linux版本号(内核版本号):三部分组成: A.B.CA:主版本号B:次版本号(奇数:开发版本">
<meta name="keywords" content="Linux">
<meta property="og:type" content="article">
<meta property="og:title" content="Linux运维基础(一)">
<meta property="og:url" content="http://yoursite.com/2018/08/09/Linux安全运维基础（一）/index.html">
<meta property="og:site_name" content="Plus Ultra">
<meta property="og:description" content="（一）Linux入门（常见命令 用户权限与管理等）标签（空格分隔）： Linux安全运维基础  [TOC] 1 虚拟机的使用创建虚拟机磁盘：虚拟机中文件形式存在（镜像文件）ifconfig 查看设置网络配置：vnet8，桥接模式vnet1：仅宿主机模式 2 操作系统概念内存，寻址空间，平面寻址，三维寻址linux版本号(内核版本号):三部分组成: A.B.CA:主版本号B:次版本号(奇数:开发版本">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2018-08-09T03:18:49.963Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Linux运维基础(一)">
<meta name="twitter:description" content="（一）Linux入门（常见命令 用户权限与管理等）标签（空格分隔）： Linux安全运维基础  [TOC] 1 虚拟机的使用创建虚拟机磁盘：虚拟机中文件形式存在（镜像文件）ifconfig 查看设置网络配置：vnet8，桥接模式vnet1：仅宿主机模式 2 操作系统概念内存，寻址空间，平面寻址，三维寻址linux版本号(内核版本号):三部分组成: A.B.CA:主版本号B:次版本号(奇数:开发版本">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/08/09/Linux安全运维基础（一）/"/>





  <title>Linux运维基础(一) | Plus Ultra</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Plus Ultra</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">仰望星空，脚踏实地</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      
        
        <li class="menu-item menu-item-categories">
          <a href="/categories/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-th"></i> <br />
            
            分类
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      

      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br />
            
            搜索
          </a>
        </li>
      
    </ul>
  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off"
             placeholder="搜索..." spellcheck="false"
             type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/09/Linux安全运维基础（一）/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Lollipop">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/site-author-image.jpg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Plus Ultra">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">Linux运维基础(一)</h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2018-08-09T10:12:29+08:00">
                2018-08-09
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/Note/" itemprop="url" rel="index">
                    <span itemprop="name">Note</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
          

          
          
             <span id="/2018/08/09/Linux安全运维基础（一）/" class="leancloud_visitors" data-flag-title="Linux运维基础(一)">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               
                 <span class="post-meta-item-text">阅读次数&#58;</span>
               
                 <span class="leancloud-visitors-count"></span>
             </span>
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="（一）Linux入门（常见命令-用户权限与管理等）"><a href="#（一）Linux入门（常见命令-用户权限与管理等）" class="headerlink" title="（一）Linux入门（常见命令 用户权限与管理等）"></a>（一）Linux入门（常见命令 用户权限与管理等）</h1><p>标签（空格分隔）： Linux安全运维基础</p>
<hr>
<p>[TOC]</p>
<h2 id="1-虚拟机的使用"><a href="#1-虚拟机的使用" class="headerlink" title="1 虚拟机的使用"></a><strong>1 虚拟机的使用</strong></h2><p>创建虚拟机<br>磁盘：虚拟机中文件形式存在（镜像文件）<br>ifconfig 查看设置<br>网络配置：vnet8，桥接模式<br>vnet1：仅宿主机模式</p>
<h2 id="2-操作系统概念"><a href="#2-操作系统概念" class="headerlink" title="2 操作系统概念"></a><strong>2 操作系统概念</strong></h2><p>内存，寻址空间，平面寻址，三维寻址<br>linux版本号(内核版本号):三部分组成:</p>
<p>A.B.C<br>A:主版本号<br>B:次版本号(奇数:开发版本 偶数:发行版本)<br>C:修订版本号(修订次数)</p>
<p>内核版本:3.6.28 3时主版本号 6:次版本号 28:修订了28次<br>先把3.6.28拷贝一份进行研发,并把版本号升级为3.7.01(在3.6.28基础上修复漏洞,开发新功能)<br>3.8.XX:下一个发行版本<br>开发–内测(修复漏洞,开发新功能)–公测–正式版本生成(正式上线)</p>
<p>~当前用户所在目录：代表用户宿主目录</p>
<h2 id="3-Linux设计哲学思想"><a href="#3-Linux设计哲学思想" class="headerlink" title="3 Linux设计哲学思想"></a><strong>3 Linux设计哲学思想</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">shell：使用者与计算机交互的接口，人输入命令给shell，shell传递给内核</span><br><span class="line">         Linux支持的shell：bash：默认使用的shell</span><br><span class="line">                                      ksh</span><br><span class="line">                                      csh</span><br><span class="line">xshell：远程连接linux  还有CRT</span><br><span class="line">         其使用方法：在同一个网段中，然后即可使用Xshell软件：ssh </span><br><span class="line">```         </span><br><span class="line">IP→输入用户名，密码</span><br><span class="line">内核作用：无论从图形界面/还是字符界面 都可以返回结果。</span><br><span class="line">1、进程管理：要执行的任务；2、内存管理；3、文件系统：存储设备上村塾数据的方式方法</span><br><span class="line">Linux ext3/4/，xfs等；4、网络功能：管理IP地址信息等；5、硬件驱动；6、安全功能；</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>##Linux设计思想</span><br><span class="line">1:有很多的小程序组成,每个小程序完成单一的功能,实现复杂的任务(http服务需要安装很多小组件)</span><br><span class="line">2:一切皆文件:所有的外围设备(硬件)或者其他程序</span><br><span class="line">3:尽量避免捕获用户接口</span><br><span class="line">4:配置文件保存为纯文本格式(可以用文本编辑器编辑 vim)</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span>##Linux终端:多用户多任务系统</span><br><span class="line">6个终端:ctrl+alt+F1-F6</span><br><span class="line">切换图形界面:ctrl+alt+F7</span><br><span class="line">切换用户:su(switch user)</span><br><span class="line">su命令:当root用户切换到普通用户时,不需要普通用户的密码;而当普通用户切换到root用户时,需要提供root用户密码</span><br><span class="line">root student</span><br><span class="line">```shell</span><br><span class="line"><span class="meta">#</span> su user_name</span><br><span class="line"><span class="meta">$</span> exit 退出当前用户</span><br></pre></td></tr></table></figure>
<p>命令格式<br>命令字 [选项] [参数]:中括号表示可以省略，例如 ls -a /ect/<br>命令字:唯一的,实现某一项功能<br>选项:修改命令的执行方式(实现特定功能)<br>长选项:–引导,是一个单词(多个长选项不能组合)<br>短选项:-引导,是一个字符(多个短选项可以组合)<br>参数:命令作用的对象</p>
<h2 id="4-高效获取命令帮助信息"><a href="#4-高效获取命令帮助信息" class="headerlink" title="4 高效获取命令帮助信息"></a><strong>4 高效获取命令帮助信息</strong></h2><p>###Linux命令分类<br>内部命令:shell自带的命令<br>外部命令:在Linux文件系统中存在一个应用程序</p>
<p>###type:查看Linux命令类型<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[command] is a shell builtin:buildin关键字说明该命令是内部命令</span><br><span class="line">mkdir is /bin/mkdir:有路径显示(外部命令)</span><br></pre></td></tr></table></figure></p>
<p>###路径<br>绝对路径:从根(/)开始的路径是绝对路径,linux系统中只有一个根<br>相对路径:以所处的工作目录为参照点 (.代表当前路径 ..代表上一级路径 ~代表登录用户的宿主目录)</p>
<p>###ls(list):列出目录<br>-l(–long):以长格式显示<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-------. 1 root root 1207 Nov 6 18:51 anaconda-ks.cfg</span><br></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">第一位:文件类型</span><br><span class="line">    -:代表普通文件(file)</span><br><span class="line">    d:代表目录(directory)</span><br><span class="line">    b:块设备(block):如硬盘,U盘等</span><br><span class="line">    c:字符设备(char):如键盘等</span><br><span class="line">    :套接字文件(socket)</span><br><span class="line">    p:命名管道(pipe)</span><br><span class="line">    l:符号链接文件(symbolic link file )</span><br><span class="line">第二到十位:权限位(rwx:读写执行)</span><br><span class="line">    234位:文件属主权限(owner)</span><br><span class="line">     567位:文件属组权限(group)</span><br><span class="line">    8910位:其他用户权限(other)</span><br><span class="line">1:  代表文件硬链接的次数</span><br><span class="line">第一个root:代表文件属主(owner)</span><br><span class="line">第二个root:代表文件属组(group)</span><br><span class="line">1207:文件的大小</span><br><span class="line">Nov 6 18:51:文件最后被访问的时间戳(stat命令查看文件时间戳)</span><br><span class="line">文件的时间戳:</span><br><span class="line">    access:访问的时间戳</span><br><span class="line">    Modify:文件被修改时间戳(修改文件数据:添加删除数据等)</span><br><span class="line">    change:文件被更改时间戳(更改文件属性)</span><br><span class="line">    anaconda-ks.cfg:文件名</span><br></pre></td></tr></table></figure>
<p>###ls命令字所带选项用法<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">-h:为文件大小添加单位，可以与ls -l联用，即ls -lh</span><br><span class="line">-a:显示目录下所有文件(包括. .. 以.开始的隐藏文件)</span><br><span class="line">-A:和-a相同,但是不显示.和..</span><br><span class="line">-R:递归显示目录中的内容(一并显示子目录中所有内容)</span><br><span class="line">-r:逆序显示目录内容</span><br><span class="line">-i:显示文件所在的inode节点(index node)</span><br><span class="line">-d:显示目录本身的属性</span><br><span class="line">递归显示-R：Recrusion</span><br><span class="line">逆序显示文件内容：-r：reverse</span><br></pre></td></tr></table></figure></p>
<p>###环境变量:内存中的命名空间<br>PATH变量:存放系统命令路径,以冒号隔开<br>查看PATH变量:echo $PATH(Linux命令严格区分大小写)存在的路径<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@www ~]# echo $PATH</span><br><span class="line">/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin:/root/bin</span><br></pre></td></tr></table></figure></p>
<p>如果在以上路径中没有找到相关命令(该命令为外部命令),提示用户command not found<br>如果一个命令在以上多个路径中存在,系统会按照从前往后的顺序查找,查找到该命令后,后面的路径的不在查找</p>
<p>hash:查看命令缓存及命中率</p>
<p>###Linux命令的帮助信息<br>    内部命令:help [command]<br>    外部命令:[command] –help<br>    man:帮助(命令的使用说明书)(查看内部命令时,显示的是bash帮助信息)<br>    语法: man [command]</p>
<p>上下方向键:翻行<br>enter:向下翻行<br>pagedown:向下翻页<br>pageup:向上翻页<br>/word:从上往下查找关键字<br>?word:从下往上查找关键字<br>q:退出当前帮助信息</p>
<p>###man目录说明<br>1:User Commands:普通用户命令(/bin /usr/bin /usr/local/bin):binary二进制<br>2:System Calls:系统调用库<br>3:C Library Functions:库调用<br>4:Devices and Special Files:设备或特殊文件(硬件设备)(硬件设备存放在/dev)<br>5:File Formats and Conventions:查看配置文件格式<br>6:Games et. Al.:游戏<br>7:Miscellanea:杂项<br>8:System Administration tools and Deamons:管理命令(/sbin /usr/sbin /usr/local/sbin)sbin:secret binary</p>
<p>which:查看命令所在的路径<br>whatis:查看命令所在的帮助信息目录,该命令在系统启动大约70分钟后会生成whatis的数据库,如果时间太短,该命令不会执行。<br>使用makewhatis(CentOS 6)初始化该命令,就不需要等待在CentOS 7中使用man的命令<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yum -y install man-pages</span><br></pre></td></tr></table></figure></p>
<p>####man使用说明<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">NAME:命令名称及简要用法</span><br><span class="line">SYNOPSIS:语法格式,可能包括一些选项的使用 如：ls -[Option]</span><br><span class="line">DESCRIPTION:命令和命令选项的详细说明</span><br><span class="line">Exit status:退出状态码</span><br><span class="line">AUTHOR:作者信息</span><br><span class="line">REPORTING BUGS(BUG):发现BUG时如何反馈信息</span><br><span class="line">COPYRIGHT:该命令的版权信息</span><br><span class="line">SEE ALSO:另外参照的帮助信息</span><br><span class="line">OPTIONS:说明该命令每一个选项的详细用法</span><br><span class="line">EXAMPLES:命令使用实例</span><br></pre></td></tr></table></figure></p>
<p>####man手册页目录<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">/usr/share/doc(工作中主要是查看内核信息)</span><br><span class="line">&lt;&gt;:必须使用的选项或参数,不可以省略</span><br><span class="line">[]:可是省略的选项或参数</span><br><span class="line">...:可以使用多个选项或参数</span><br><span class="line">|:代表多选一</span><br><span class="line">&#123;&#125;:分组,没有特殊意义</span><br></pre></td></tr></table></figure></p>
<p>###一些常用命令<br>info:在线查看帮助,注重于命令历,版史权信息等<br>cd:change directory(切换目录)<br>    cd:不加选项,返回到当前用户的宿主目录<br>    -:返回到上一次的工作路径<br>    ~username:切换到username的宿主目录<br>pwd:print working directory:显示当前所处的工作目录</p>
<h2 id="5-Linux根文件系统"><a href="#5-Linux根文件系统" class="headerlink" title="5 Linux根文件系统"></a><strong>5 Linux根文件系统</strong></h2><blockquote>
<p>Linux目录结构是一个倒树形的：<br>最上面的是根，Linux只有一个根；Windows有多个根。而Linux的系统类型又多（发行产商较多），为统一每个系统下的文件目录，产生了一个标准，即FHS标准：希望用户可以了解已经安装的系统</p>
</blockquote>
<p>###FHS标准<br>文件系统分层结构标准（File System Hierarchy Standard）<br>FHS规定:/etc /bin /dev /lib /sbin五个目录必须要和根目录位于同一文件系统<br><a href="https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard" target="_blank" rel="noopener">https://en.wikipedia.org/wiki/Filesystem_Hierarchy_Standard</a><br><a href="https://linux.cn/article-6132-1.html" target="_blank" rel="noopener">https://linux.cn/article-6132-1.html</a></p>
<p>###根目录下目录及子目录的作用</p>
<p>####根文件文件系统<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">(/):rootfs:root filesystem，主层次根</span><br><span class="line">/bin: 单用户二进制命令文件,存放命令</span><br><span class="line">/boot: 引导加载驱动，存放启动和内核相关文件</span><br><span class="line">/dev: 存放设备文件</span><br><span class="line">/etc: 存放应用程序的配置文件</span><br><span class="line">   /etc/ resolv.conf DNS配置地址</span><br><span class="line">   /etc/hosts Hosts信息</span><br><span class="line">   /etc/sysconfig 网络配置</span><br><span class="line">/home:普通用户的家目录,默认为/home/USERNAME</span><br><span class="line">/lib和/lib64:存放系统开机时需要用的函数库及/bin和/sbin命令调用函数库</span><br><span class="line">/lib/modules:存放内核相关的模块(驱动程序等)</span><br><span class="line">/media和/mnt:挂载点,/media挂载移动设备 /mnt挂载临时设备</span><br><span class="line">/opt:第三方软件存放目录(用户自行安装的软件存放处),现在一般安装到/usr/local下</span><br><span class="line">/proc:伪文件系统,数据存放在内存中,存放关于进程的相关信息，有CPU、内核的信息，系统调优的时候可以在此目录进行修改配置，</span><br><span class="line">/root:管理员的家目录</span><br><span class="line">/sbin:存放管理员使用的命令，只有管理员可执行</span><br><span class="line">/srv:service缩写,存放服务数据目录,如可以把www服务的网页存放到该目录</span><br><span class="line">/tmp:存放临时文件,所有用户都可以访问创建文件,但是每个用户只能删除自己的文件；一定时间后系统会删除</span><br><span class="line">/sys:伪文件系统,存放在内存中,记录内核相关的信息,包括目前加载内核模块和内核检测到的硬件设备等</span><br><span class="line">/usr:UNIX software resource:存放安装的应用程序</span><br><span class="line">   /usr/bin:普通用户使用的命令(和/bin区别是否与开机有关)</span><br><span class="line">   /usr/sbin: 网络服务器命令</span><br><span class="line">   /usr/lib和/usr/lib64: 包含各种应用程序函数库</span><br><span class="line">   /usr/share:存放共享文件目录(在线帮助文件,杂项,时区文件等)</span><br><span class="line">   /usr/include:存放头文件，比如C语言的头文件，安装软件的头文件</span><br><span class="line">   /usr/src:释放源代码目录</span><br><span class="line">/var: vary缩写,存放经常变动的文件,比如 志,mail等， 持续改变的各种文件存放位置 包括cache、mail、lock、log、mail、spool</span><br><span class="line">    /var/cache:存放应用程序运行时产生的缓存文件</span><br><span class="line">    /var/lib:程序运行时,需要使用的数据文件的存放目录，比如MySQL的文件即可能放在这里</span><br><span class="line">    /var/lock:设备或资源一次只能被一个应用程序使用,如果多应用程序会产生错误,因为要为设备或资源上锁(存放锁文件)</span><br><span class="line">    /var/log:存放日志目录(系统,用户登录,服务日志等)</span><br><span class="line">    /var/mail:存放个人电子邮件(系统报警产生邮件信息等)</span><br><span class="line">    /var/run:存放应用程序运行时PID文件(进程号.pid结尾)</span><br><span class="line">    /var/spool:存放队列数据,排队等待其他用户程序使用的数据,数据通常使用完成后会被删除</span><br><span class="line">./ sgml存放处理标准通用标记语言的配置文件</span><br><span class="line">./xml 处理xml的配置文件</span><br></pre></td></tr></table></figure></p>
<p>###/bin、/sbin、/usr/bin三者区别<br>/bin：存放的是系统启动时的二进制指令<br>/usr/bin：与开机无关</p>
<blockquote>
<p>The root file system is the file system contained on the same disk<br>partition on which the root directory is located; it is the filesystem<br>on top of which all other file systems are mounted as the system boots<br>up.<br>     根文件系统是包含在根目录所在的同一磁盘分区上的文件系统; 它是文件系统，在系统启动时安装所有其他文件系统。</p>
</blockquote>
<p>file命令:查看linux中文件类型<br>语法: file [options] file_name</p>
<p>###Linux文件名限制<br>1:单个文件或目录的名称不能超过255字符<br>2:文件命中不能包含特殊字符(/ . - +等)</p>
<p>###Linux文件类型<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">-:普通文件</span><br><span class="line">纯文本文件(ASCII):配置文件</span><br><span class="line">二进制文件(binary file): 命令</span><br><span class="line">数据格式文件(data):/var/log/wtmp</span><br><span class="line">d:目录文件</span><br><span class="line">l:链接文件:软链接文件</span><br><span class="line">设备文件:(/dev)</span><br><span class="line">b:block块设备</span><br><span class="line">c:character字符集设备:一次性读取,按顺序读取</span><br><span class="line">s:socket套接字文件:通常用在网络上数据连接: IP:PORT</span><br><span class="line">p:管道:特殊的文件类型,解决多个程序同时访问一个文件所造成的错误问题</span><br><span class="line">在Linux一个文件是否能被执行，和后缀扩展名没有很大关系，所以需要用到file来使用</span><br></pre></td></tr></table></figure></p>
<h2 id="6-Linux-常见命令"><a href="#6-Linux-常见命令" class="headerlink" title="6 Linux 常见命令"></a><strong>6 Linux 常见命令</strong></h2><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Vim：vi 编辑创建文件，insert键入编辑文本，ESC退出编辑，":wq",write and quit，如果不想保存就直接 q就可以了</span><br><span class="line">cat &#123;abc.txt，def.txt，...&#125; /... 在...目录下同时创建几个...文件</span><br></pre></td></tr></table></figure>
<p>基本命令:ls cd pwd<br>学习内容:file cat cp mv rm mkdir touch tree which whereis<br>文件管理；目录管理；系统管理；网络管理等</p>
<p>###file<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">语法:file [options] [args]:查看文件类型(windows是用扩展名识别文件类型)</span><br><span class="line">-b:显示结果时,不显示文件名</span><br><span class="line">-c:显示执行file命令的执行过程(file是如何去判断文件类型),便于排错或分析file命令执行过程</span><br><span class="line">-i:输出MIME类型的字符串</span><br><span class="line">-z:显示压缩文件的内容</span><br><span class="line">-L:查看软链接对应文件的类型</span><br><span class="line">-f:查看文件中文件名的类型</span><br></pre></td></tr></table></figure></p>
<p>查看文本文件内容命令:cat more less head tail<br>Linux和Windows中文件内容行尾标记是不同的:<br>Linux中是以$为结尾<br>Windows中是以ENTER键结尾</p>
<p>###cat<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">1:一次性查看整个文件 </span><br><span class="line">语法:cat [options] [args]</span><br><span class="line">2:从键盘输入创建一个新文件或向现有文件中添加新数据: </span><br><span class="line">新建新文件:cat &gt;new_file_name &lt;&lt;EOF //EOF:end of file</span><br><span class="line"><span class="meta">&gt;</span>Linux command //从键盘输入</span><br><span class="line"><span class="meta">&gt;</span>Uinx command //从键盘输入</span><br><span class="line"><span class="meta">&gt;</span>EOF //从键盘输入,以结束书写</span><br><span class="line">向现有文件中追加数据:</span><br><span class="line">cat &gt;&gt; file_name &lt;&lt; EOF</span><br><span class="line"><span class="meta">&gt;</span>CISP!</span><br><span class="line"><span class="meta">&gt;</span>CISSP!</span><br><span class="line"><span class="meta">&gt;</span>EOF</span><br><span class="line">3:把多个文件内容合并到一个文件输出:</span><br><span class="line">cat file1 file2 &gt; file3</span><br></pre></td></tr></table></figure></p>
<p>cat /etc/passwd /etc/shadow &gt; /root/user.txt<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-n:显示文件内容时同时显示行号,包括空行</span><br><span class="line">-b:和-n功能相同,但不包括空行</span><br><span class="line">-S:当文件中有多个空行时,合并为一个空行</span><br><span class="line">-E:在显示内容时,结尾添加$符号</span><br></pre></td></tr></table></figure></p>
<p>###more</p>
<p>可以翻页查看文本文件内容<br>enter键:向下翻一行<br>空格键:向下翻一屏<br>ctrl+b:向上翻一屏<br>ctrl+f:向下翻一屏<br>=:显示当前的行号<br>v:调用vi编辑器<br>!command:调用shell执行命令<br>q:退出more命令</p>
<p><strong>more +num file_name //从num行开始查看文件内容</strong></p>
<p>###less</p>
<p>可以翻页查看文本文件内容<br>enter键:向下翻一行<br>空格键:向下翻一屏<br>pagedown:向下翻一屏<br>pageup:向上翻一屏<br>上下方向键:向上/向下翻一行<br>/word:在该文件中查找word关键字<br>n:查找下一个<br>N:查找上一个</p>
<p>###管道<br>连接多条命令,前一条命令输出结果作为后一条命令的输入条件, 管道符 | </p>
<p>###head<br>默认查看文件文件的前十行<br>-n:查看文件文件前n行</p>
<p>###tail<br>默认查看文本文件的后十行<br>-n:查看文本文件的后n行<br>-f:动态查看文本文件内容,如动态查看日志: tail -f /var/log/messages<br>在任何位置均可进行查看，当系统有安装/服务启动关闭等行为时，会马上有记录出现</p>
<p>###cp<br>复制文件或目录(copy简写)<br>语法:cp [options] [src_file] [des_file]<br>-f:force,强制复制文件或目录不进行提示<br>-r:递归复制目录<br>-s:为某个文件创建符号链接(软链接),而不是复制文件<br>-b:覆盖已有的文件前,对目标文件进行备份<br>-l:为文件创建硬链接,而不是复制文件<br>-p:复制文件时保留文件的原有属性<br>-d:当复制软链接文件时,把目标文件或目录也会创建为软链接,并指向最原始的文件<br>-i:覆盖目标文件前询问(cp = cp -i)</p>
<h3 id="mv-move"><a href="#mv-move" class="headerlink" title="mv: move"></a>mv: move</h3><p>移动或从命名文件和目录<br>(当原位置和目标位置是同一目录时,是重命名;当原位置和目标位置不是同一目录时,是移动)<br>-b:移动前先对源文件进行备份<br>-f:强制覆盖<br>-i:覆盖目标文件前询问<br>-t:将多个文件移动同一个目录(目标目录在前面,后面跟文件 mv -t [directory] file1 file2 …)</p>
<p>###rm: remove<br>删除文件或目录<br>-d:删除可能存在数据的目录<br>-f:强制删除<br>-i:删除前进行询问<br>-r:递归删除整个目录<br>-v:显示命令执行过程</p>
<p>###mkdir<br>make directory,创建空目录<br>-m:创建目录时同时设置权限<br>-p:递归创建新目录<br>-v:显示创建目录的过程</p>
<p>###touch<br>创建新文件或者修改文件时间戳<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">-a:只改变访问时间</span><br><span class="line">-c:不创建文件</span><br><span class="line">-d:使用指定时间戳创建新文件,而不是使用系统时间</span><br><span class="line">-t:使用指定格式时间戳创建新文件,而不是使用系统时间</span><br><span class="line">-f:解决与BSD系列Unix系统兼容性</span><br><span class="line">-m:只更改变动时间</span><br></pre></td></tr></table></figure></p>
<p>tree:查看目录树(tree = ls -R)<br>yum -y install tree</p>
<p>which:查找命令所在的路径<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">whereis:查看命令所在的路径,源代码文件,帮助信息文件所在的文件</span><br><span class="line">-b:只查看文件所在的位置(等同于which命令)</span><br><span class="line">-m:只查看帮助信息所在的位置</span><br><span class="line">-s:支持看源代码所在的位置</span><br></pre></td></tr></table></figure></p>
<h2 id="7-Shell特性"><a href="#7-Shell特性" class="headerlink" title="7 Shell特性"></a><strong>7 Shell特性</strong></h2><p>安装进程树命令：yum install psmisc<br>pstree 进程树命令 pstree -p</p>
<p>###shell广义分类<br>GUI:包括GNOME KDE XFACE等<br>CLI:sh csh ksh bash等(Linux发行版本中,bash是默认使用的shell程序)</p>
<p>shell启动:当用户登录完成后,系统会自动启动shell程序<br>进程:应用程序的副本;使用PID区分(在系统中,一个进程只认为自己存在)<br>root student用户<br>shell:父shell程序和子shell程序(父子shell之间设置环境互相独立,互不影响)<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cat /etc/shells //查看当前系统所支持的shell程序</span><br><span class="line">yum -y install ksh csh //安装ksh,csh的shell程序</span><br><span class="line">exit //退出当前shell程序</span><br></pre></td></tr></table></figure></p>
<p>shell是一个程序</p>
<p>###bash特性</p>
<p>####命令历史:<br>     Linux会自动记录系统过去执行的命令,并保存在内存的缓冲区中，在每个用户的家目录下,有个隐藏文件.bash_history保存命令历史</p>
<pre><code> # history //查看linux的历史
-c:清空命令历史
-d:删除某一条命令历史
-w:将命令历史保存到某个文件中
变量:PATH命令路径变量
HISTSIZE:命令历史大小变量
$ echo $HISTSIZE //查看HISTSIZE变量的值,默认的命令历史是1000条
命令历史使用技巧:
!n:执行命令历史中的第n条命令(n是命令历史编号)
!-n:执行命令历史中的倒数第n条命令(n是命令历史编号)
!word:执行命令历史中最近一次以word开始的命令(word必须能够唯一的标识用户想执行的命令)
!!:执行上一条命令
!$:引用一个命令的最后一次参数
ESC键(按完松开) 再按.键:引用一个命令的最后一次参数
</code></pre><p>####命令行编辑：<br>ctrl+a:光标快速跳转到命令行的行首<br>ctrl+e:光标快速跳转到命令行的行尾<br>ctrl+u:快速删除光标位置到命令行行首的字符<br>ctrl+k:快速删除光标位置到命令行行尾的字符<br>ctrl+l:清屏(命令clear:清屏)</p>
<p>####命令行展开<br>     双Tab可以显示与关键输入相关的所有命令<br>     当有唯一识别度的时候，单Tab可以显示命令<br>     $(COMMAND) 常用于shell脚本编程<br>          3.1:命令补齐:在PATH变量搜索命令并补齐(PATH变量必须正常,输入要补齐命令的字符数一定能够唯一标识这条命令;tab键补齐)<br>        按tab键两次,列出以某个字符开始的所有的命令</p>
<pre><code>    # echo $PATH //查看PATH变量的值
    路径和文件补齐:在系统路径中查找
    命令行补齐功能不能补齐选项
     3.2:命令替换(经常用到shell脚本编程中) $(command)或者 `command`(两边是反撇号)
    命令替换就是把命令中的子命令替换成子命令执行结果的过程
# echo &quot;字符串&quot;
&quot;&quot;(双引号):弱引用(可是实现变量的替换,把变量名替换为变量值)
``(反撇号):命令引用
&apos;&apos;(单引号):强引用(不能完成变量替换)
     例如：
     [root@localhost ~]# echo &apos;Directory is $(pwd).&apos;
     Directory is $(pwd).
     [root@localhost ~]# echo &quot;Directory is $(pwd).&quot;
     Directory is /root.
     单引号和双引号效果不一样，双引号执行命令，单引号不执行。
</code></pre><p>####命令别名<br>(alias定义的别名只在当前shell生效)<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span> alias COMM_ALIAS=COMMAND //只执行alias命令,列出系统中所有的命令别名</span><br><span class="line">注意:执行alias命令时,COMMAND最好用''(引号)引起来</span><br><span class="line">例如：alias cdnet='cd /etc/sysconfig/network-scripts'</span><br><span class="line"><span class="meta">#</span> unalias COMM_ALIAS //取消命令别名</span><br></pre></td></tr></table></figure></p>
<p>命令行通配:globbing<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">与正则表达类似</span><br><span class="line">*:匹配任意长度的任意字符</span><br><span class="line">?:匹配任意单个字符</span><br><span class="line">[]:匹配指定范围内的任意单个字符</span><br><span class="line">[ab] [a-m] [a-z] [A-Z] [a-zA-Z] [0-9] [a-zA-Z0-9]</span><br><span class="line">[^]:匹配指定范围外的任意单个字符</span><br><span class="line">[^a-z] [^0-9]</span><br><span class="line">使用示例：https://www.cnblogs.com/tdcqma/p/5853020.html</span><br><span class="line">[:space:]:表示空格</span><br><span class="line">[:punct:]:表示所有标点符号</span><br><span class="line">[:lower:]:表示所有小写字母</span><br><span class="line">[:upper:]:表示所有大写字母</span><br><span class="line">[:alpha:]:表示所有字母(包括大小写)</span><br><span class="line">[:digit:]:表示所有数字</span><br><span class="line">[:alnum:]:表示所有数字和大小写字母</span><br></pre></td></tr></table></figure></p>
<p>###IO输入输出重定向以及管道<br>计算机体系结构:<br>控制器:CPU,读取系统指令<br>运算器:CPU,运算<br>存储器:RAM(内部存储器:易失性存储器)<br>输入设备(Input):输入数据,如键盘,硬盘等<br>输出设备(Output):显示指令执行结果,如显示器,音响,硬盘等</p>
<p>####计算机总线bus<br>地址总线:负责内存寻址<br>数据总线:负责传输数据<br>控制总线:负责控制指令<br>寄存器:CPU中内部临时存储空间</p>
<p>I/O设备:负责计算机内部存储设备和外部存储设备(如硬盘,光盘,U盘等)进行交互的设备</p>
<p>程序:指令+数据<br>指令:有程序提供,负责加工数据<br>数据:系统中数据可以有多种来源,比如来自变量,来自文件,来自输入设备等</p>
<p>####系统默认数据来源<br>当用户没有为指令指定数据来源时,系统要有默认的数据来源：<br>    标准输入输出设备:<br>    标准输入设备:键盘(stdin),文件描述符为0<br>    标准输出设备:显示器(stdout),文件描述符为1<br>    标准错误输出设备:显示器(stderr),文件描述符为2<br>三种数据流:<br>    标准输入数据流/标准输出数据流/标准错误输出数据流</p>
<p>当在Liunx中打开一个文件时,内核会反复调用,对于文件标识就很重要了,用文件描述符来标识文件,文件加载完成用数字标识<br>fd:file descriptor(文件描述符)</p>
<p>####IO重定向<br>把默认输入输出数据来源,重新定向到其他的文件或设备<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">1 输出重定向:</span><br><span class="line">    &gt;:覆盖输出重定向</span><br><span class="line">    &gt;&gt;:追加输出重定向</span><br><span class="line">    2&gt;:错误覆盖输出重定向</span><br><span class="line">    2&gt;&gt;:错误追加输出重定向</span><br><span class="line">    &amp;&gt;:混合覆盖输出重定向</span><br><span class="line">    &amp;&gt;&gt;:混合追加输出重定向</span><br><span class="line">2 输入重定向:</span><br><span class="line">    &lt;:输入重定向</span><br></pre></td></tr></table></figure></p>
<p>管道:连接多条命令,把前一条命令的输出结果作为后一条命令的输入条件(组合小程序,实现大功能)    <code>command1 | command2 | commad3 ....</code></p>
<p>tr:实现字符转换,不修改源文件,语法:tr [OPTION]… SET1 [SET2]<br>例如：<code>cat 文件 | tr &#39;a-z&#39; &#39;A-Z&#39;</code><br>tee: 将数据重定向到文件，另一方面还可以提供一份重定向数据的副本作为后续命令的stdin<br><a href="http://man.linuxde.net/tee" target="_blank" rel="noopener">http://man.linuxde.net/tee</a><br>变量<br>编程</p>
<h2 id="8-用户"><a href="#8-用户" class="headerlink" title="8 用户"></a><strong>8 用户</strong></h2><p>&ensp;&ensp;&ensp;&ensp;Linux实现权限隔离机制(多用户)，用多用户分组实现。操作系统使用UID来识别用户，而如果同一个文件多个用户都有相同权限时，启用组GID。<br>操作系统识别用户:<br>&ensp;&ensp;&ensp;&ensp;用户:UID（管理员用户0；普通用户1000-65535；程序/系统用户1-999）<br>&ensp;&ensp;&ensp;&ensp;组:GID(逻辑容器:包含用户;实现多个用户对于某个文件或应用程序分配相同的权限)<br>组分类：管理员组/普通组<br>&ensp;&ensp;&ensp;&ensp;基本组:Linux中,新建用户时,没有指定隶属于的组,系统会为该用户建立一个同名组,作为该用户基本组<br>&ensp;&ensp;&ensp;&ensp;附加组:方便以后为用户分配文件/程序权限</p>
<p>process(进程):用户执行应用程序的过程，Ngix用户、MySQL用户，不允许登录到操作系统，只是作为系统用户来运行某个程序。</p>
<p>###/etc/passwd解释<br>用冒号隔开：name:password:UID:GID:GECOS:directory:shell<br>第一列:用户的登录名<br>第二列:加密密码(x表示密码占位符,密码保存在/etc/shadow中)<br>第三列:用户的ID号<br>第四列:组的ID号<br>第五列:用户的描述信息<br>第六列:用户宿主目录<br>第七列:用户默认使用的shell(/etc/shells)</p>
<p>###/etc/shadow解释<br>第一列:用户的登录名<br>第二列:用户加密后的密码<br>第三列:最后一次更改密码时间(从1970年1月1号)<br>第四列:密码最小使用时间<br>第五列:密码最长使用时间</p>
<p>###/etc/shadow密码区域解释<br>(格式:$id$salt$encrypted):<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">三部分组成:用$隔开</span><br><span class="line">    第一部分加密算法:</span><br><span class="line">        1:MD5加密</span><br><span class="line">        5:SHA-256加密</span><br><span class="line">        6:SHA-512加密</span><br><span class="line">    第二部分:随机序列号</span><br><span class="line">    第三部分:随机序列号和密码共同加密后的字符串</span><br></pre></td></tr></table></figure></p>
<p>加密算法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">对称加密:加密和解密使用相同的密码(效率高)</span><br><span class="line">非对称加密:加密和解密使用不同的秘钥,公钥和私钥</span><br><span class="line">单向加密,散列加密:提取数据的特征码,常用于数据完整性校验</span><br><span class="line">    1:不可逆</span><br><span class="line">    2:定长输出</span><br><span class="line">        md5: 128位定长输出</span><br><span class="line">        sha: 160位 224位 256 位 384位 512位</span><br><span class="line">    3:雪崩效应:输入数据一小点儿的变化,会引起结果的巨大变化</span><br></pre></td></tr></table></figure></p>
<p>例：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/default/useradd</span><br><span class="line"># useradd defaults file</span><br><span class="line">GROUP=100   //可以创建普通组</span><br><span class="line">HOME=/home   //普通用户宿主目录位置(在/home下生成和用户同名的目录,作为用户的宿主目录)</span><br><span class="line">INACTIVE=-1  //是否启用户过期停止使用权,-1代表不启用，如果是2则，是过期后两天停止使用权</span><br><span class="line">EXPIRE=        //设定过期时间,格式为20170501</span><br><span class="line">SHELL=/bin/bash  //设定用户的默认使用shell</span><br><span class="line">SKEL=/etc/skel  //新用户宿主目录模板目录</span><br><span class="line">CREATE_MAIL_SPOOL=yes  //是否为用户启用邮件通知功能 </span><br><span class="line"></span><br><span class="line">SKEL=/etc/skel  //新用户宿主目录模板目录（隐藏文件）：</span><br><span class="line">[root@localhost ~]# ls -a /etc/skel</span><br><span class="line">. .. .bash_logout .bash_profile .bashrc</span><br><span class="line">[root@localhost ~]# ls -a /home/jerry/</span><br><span class="line">. .. .bash_logout .bash_profile .bashrc</span><br></pre></td></tr></table></figure></p>
<p>###/etc/skel:目录解释<br>(用户宿主目录模板目录,只对新建用户生效)<br>.bash_logout:用户注销时执行的命令<br>.bash_profile:用户登录系统时执行的命令(用户变量)<br>.bashrc:用户登录一个新shell时执行的命令</p>
<p>###/etc/login.defs文件解释<br>(只对新建用户生效，修改后对以前的用户不会产生影响)<br>MAIL_DIR /var/spool/mail //用户系统邮件存放目录<br>PASS_MAX_DAYS 99999 //密码最长使用期限<br>PASS_MIN_DAYS 0 //最短使用期限,0代表不受限制<br>PASS_MIN_LEN 5 //密码最小长度，5代表5个字符<br>PASS_WARN_AGE 7 //密码过期前的警告时间，<br>UID_MIN 1000 //最小UID号<br>UID_MAX 60000 //最大UID号<br>SYS_UID_MIN 201 //系统用户最小UID<br>SYS_UID_MAX 999 //系统用户最大UID<br>GID_MIN 1000 //普通组最小GID<br>GID_MAX 60000 //普通组最大GID<br>SYS_GID_MIN 201 //系统组最小GID<br>SYS_GID_MAX 999 //系统组最大GID<br>CREATE_HOME yes //是否创建宿主目录<br>UMASK 077 //关于权限反掩码<br>USERGROUPS_ENAB yes //删除用户时是否删除组<br>ENCRYPT_METHOD SHA512 //用户密码的加密方式</p>
<h2 id="9-用户管理命令"><a href="#9-用户管理命令" class="headerlink" title="9 用户管理命令"></a><strong>9 用户管理命令</strong></h2><h3 id="用户管理"><a href="#用户管理" class="headerlink" title="用户管理:"></a>用户管理:</h3><p>USERADD<br>useradd, userdel, usermod, passwd, chsh, chfn, finger, id, chage<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># yum -y install vim make cmake man man-pages mlocate sysstat net-tools</span><br><span class="line"># yum -y groupinstall &quot;Development tools&quot;</span><br><span class="line"># mandb //生成whatis数据库</span><br><span class="line"># updatedb //生成locate数据库</span><br><span class="line"># vim /etc/selinux/config</span><br><span class="line">SELINUX=disabled</span><br></pre></td></tr></table></figure></p>
<p>####useradd:添加新用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">(更改/etc/passwd /etc/shadow /etc/group)</span><br><span class="line">    useradd [options] user_name </span><br><span class="line">    -c:为用户添加描述信息</span><br><span class="line">    -d:指定用户的宿主目录(默认宿主目录在/home目录)</span><br><span class="line">     useradd -d /.../用户名 用户名</span><br><span class="line">    -D:查看和改变默认的值(修改/etc/default/useradd文件中的选项和值)</span><br><span class="line">            -g:修改组</span><br><span class="line">            -b:修改宿主目录</span><br><span class="line">            -f:修改过期是否停用</span><br><span class="line">            -e:修改过期 时间</span><br><span class="line">            -s:修改默认shell</span><br><span class="line">    -e:新建用户时,设置用户默认的过期时间,时间格式为:YYYY-MM-DD</span><br><span class="line">     -g:指定用户的基本组(没有该选项,Linux新建用户时,会新建一个同名组作为用户的基本组)</span><br><span class="line">    -G:新建用户时指定用户的附加组,附加组可以有多个,用逗号隔开</span><br><span class="line">    -m:创建宿主目录,和-k一起使用</span><br><span class="line">    -M:创建用户时,不为用户创建宿主目录</span><br><span class="line">    -p:创建用户时,为用户设置加密的密码(不推荐使用)</span><br><span class="line">    -r:创建系统用户(不创建宿主目录,UID和GID使用系统用户ID)</span><br><span class="line">    -s:指定默认的shell(系统支持的shell)</span><br><span class="line">    -u:指定用户的UID</span><br></pre></td></tr></table></figure></p>
<p>####passwd:为用户设置密码/锁定解锁用户/查看状态<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">语法:passwd [options] user_name</span><br><span class="line">    root用户可以为普通用户设置密码</span><br><span class="line">    -l:锁定用户(暂时无法登陆系统)</span><br><span class="line">    -u:解锁用户</span><br><span class="line">    -S(大写):查看用户状态,显示/etc/shadow文件中各个字段的内容 （LK、PS）</span><br><span class="line">    --stdin:标准输入,经常用在shell脚本编程中为用户自动设置密码</span><br><span class="line">         如： echo “123” | passwd -- stdin tom（用户名）</span><br><span class="line">    -d:删除用户密码（root用户）,允许普通用户以空密码登录(不建议使用)</span><br><span class="line">    -e:设置用户密码过期,用户再次登录时,需要修改密码</span><br><span class="line">    -n:设置密码最小使用期限,修改/etc/shadow中第四列 </span><br><span class="line">    -x:设置密码最大使用期限,修改/etc/shadow中第五列</span><br><span class="line">    -w:设置密码过期前的警告时间,修改/etc/shadow第六列</span><br><span class="line">    -i:修改过期后的宽限时间,修改/etc/shadow第七列</span><br><span class="line">锁定密码：多了两个感叹号</span><br></pre></td></tr></table></figure></p>
<p>普通用户设置密码时,先验证当前密码,符合密码策略<br>root用户设置密码时,不需要验证当前密码,并且也可以不要求符合密码策略</p>
<p>####/etc/shadow:保存用户密码相关信息的文件<br>第一列:用户登录名<br>第二列:加密密码($id$salt$encrypted password)<br>第三列:最后一次更改密码时间<br>第四列:密码最小使用时间(用户无法更改密码)<br>第五列:密码最大使用期限(用户必须更改密码的时间)<br>第六列:密码过期前的警告时间<br>第七列:密码过期后一个宽限时间<br>第八列:密码失效时间<br>第九列:保留 </p>
<p>####userdel:删除用户<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(修改/etc/passwd /etc/shadow /etc/group文件)</span><br><span class="line">语法:userdel [options] user_name</span><br><span class="line">-r:删除用户时,连同删除用户的宿主目录</span><br></pre></td></tr></table></figure></p>
<p>####usermod:修改用户属性</p>
<p>(修改/etc/passwd中内容)很多命令与useradd相似<br>语法:usermod [options] user_name<br>-c:更改用户的描述信息<br>-d:更改用户的宿主目录<br>-e:更改用户的过期时间,格式YYYY-MM-DD<br>-f:修改/etc/shadow第七列内容<br>-g:修改用户的基本组<br>-G:修改用户的附加组<br>-l:修改用户的登录名<br>-s:修改用户的shell(系统支持的shell程序)<br>-L(大写):锁定用户<br>-U(大写):解锁用户</p>
<p>####chsh:修改用户的shell<br>语法:chsh [options] user_name<br>-s:后面跟shell,更改用户的shell<br>-l:显示当前系统支持的shell(/etc/shells)</p>
<p>####finger:显示用户的基本信息<br>finger [options] user_name</p>
<p>chfn:修改用户的基本信息<br>语法:chfn [options] user_name<br>-o:修改办公室<br>-p:修改办公室电话号码<br>-h:修改家庭电话号码<br>-f:修改用户名</p>
<p>id:显示用户和组的ID<br>语法:id [options] user_name<br>-a:忽略其他版本区别<br>-Z(大写):显示安全上下文内容(selinux)<br>-g:显示有效组的ID<br>-G:显示所有组的ID<br>-n:不显示组号,显示名字<br>-u:显示用户ID</p>
<p>####chage:修改用户密码的时间信息(/etc/shadow)<br>语法:chage [options] user_name<br>-l:列出用户的详细的密码参数<br>-d:修改/etc/shadow第三列内容,后面跟日期,格式YYYY-MM-DD<br>-E:修改/etc/shadow第八列内容,后面跟日期,格式YYYY-MM-DD<br>-I:修改/etc/shadow第七列内容,后面跟天数<br>-m:修改/etc/shadow第四列内容,后面跟天数<br>-M:修改/etc/shadow第五列内容,后面跟天数<br>-W:修改/etc/shadow第六列内容,后面跟天数</p>
<p>###用户组管理<br><strong>groupadd, groupdel, groupmod, gpasswd,newgrp,groupmems</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/group</span><br><span class="line">root:x:0:</span><br><span class="line">bin:x:1:</span><br><span class="line">daemon:x:2:</span><br></pre></td></tr></table></figure></p>
<p>####/etc/group:信息解释<br>     第一列:组的名字<br>     第二列:组的密码区域<br>     第三列:组的ID号(GID)<br>     第四列:组中的成员（初始化成员不显示）<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost ~]# cat /etc/gshadow</span><br><span class="line">root:::</span><br><span class="line">bin:::</span><br><span class="line">daemon:::</span><br></pre></td></tr></table></figure></p>
<p>####/etc/gshadow:<br>第一列:组的名字<br>第二列:组的密码<br>第三列:组的管理员<br>第四列:组成员列表</p>
<p>####groupadd<br>-d:创建组时指定组的ID<br>-r:添加一个系统组</p>
<p>####groupdel:删除一个组<br>默认情况下,不能删除一个用户的基本组,可以通过修改用户的基本组后删除该组<br>userdel -r 可以删除用户的同时,系统会删除同名基本组(该组是一个用户的基本组) </p>
<p>####groupmod:修改组的属性<br>-g:修改组的GID号<br>-n:为组重命名</p>
<p>####gpasswd:为组设置密码,设置组的管理员,添加组成员<br>-A:为组设置管理员 Administrator<br>-M:把一些用户添加组中,用逗号隔开(普通用户)<br>-r:为组移除密码<br>-R:让组的密码失效<br>-a:为组添加成员(组的管理员操作命令)<br>-d:删除组成员(组的管理员操作命令)</p>
<p>####newgrp:为用户修改有效组(只在当前shell生效)<br>exit:退出newgrp</p>
<p>groupmems:为组添加成员,显示组成员列表</p>
<h2 id="10-Linux权限"><a href="#10-Linux权限" class="headerlink" title="10 Linux权限"></a><strong>10 Linux权限</strong></h2><p>###文件<br>r(read):读权限,可以查看文件的内容,使用cat more等命令<br>w(write):写权限,可以修改文件的内容及删除文件<br>x(execute):执行权限,可执行文件或脚本</p>
<p>###目录<br>r:读权限,可以查看目录中的列表,执行ls命令<br>w:写权限,可以向目录中新建文件或目录等<br>x:执行权限,可以执行cd命令</p>
<p>###权限用数字表示<br>r:4<br>w:2<br>x:1<br>—:000 0<br>rwx:111 </p>
<p>###chown:change owner改变文件属主和属组<br>     -R:递归更改目录的属主或属组<br>     –reference:复制一个目录的权限属性到目标文件<br>     chown:修改文件属组时,在组名前添加点符号(.)或冒号(:)</p>
<p>同时修改属主和属组:chown username.groupname filename</p>
<p>###chgrp:change group修改文件属组</p>
<p>###chmod:修改文件或目录权限<br>语法:chmod [augo][+-=][rwx] file_name<br>-R:递归更改文件或目录的权限</p>
<p>a:所有用户<br>u:文件属主<br>g:文件属组<br>o:其他用户</p>
<p>+:为用户添加权限<br>-:为用户减少权限<br>=:为用户赋予权限<br>例如：chown a+x  a</p>
<p>默认情况下,为了安全,Linux系统新建文件时不添加执行权限<br>新建文本文件时候的权限一般为644<br>新建目录时候，执行cd命令：755</p>
<p>###umask:反掩码(在/etc/login.defs中定义)<br>rwx:7<br>文件:rw-rw-rw-:666 644=rw-r–r–<br>目录:rwxrwxrwx:777 755=rwxr-xr-x<br>新建文件时,权限掩码(666)减去反掩码(022)就是新建文件的权限(644)<br>新建目录时,权限掩码(777)减去反掩码(022)就是新建目录的权限(755)<br>掩码发生变化权限也会发生变化</p>
<p>###Linux隐藏权限</p>
<p>####chattr:修改文件的隐藏权限<br>/  /dev/  /tmp  /var/  /etc/目录不受chattr保护<br>语法: chattr +-= [options] file_name<br>     a:只能向文件中追加数据,不能删除 Append only<br>chattr +a 文件名，echo “…”&gt;&gt;…文件名<br>      i:任何用户不能删除文件<br>     A:不同步访问时间<br>     +:添加相应权限<br>     -:删除相应权限<br>     =:设定相应权限</p>
<p>####lsattr:查看文件或目录的隐藏权限<br>/etc/passwd /etc/shadow /etc/group<br>tom:/etc/passwd /etc/shadow /etc/group添加信息,新建宿主目录(修改宿主目录的归属)<br>echo “tom:x:1001:1001::/home/tom:/bin/bash” &gt;&gt; /etc/passwd<br>使用追加的方法去新建用户：追加passwd和shadow中的用户信息，然后复制模板目录文件；最后修改全部归属的权限。</p>
<h2 id="11-Linux认证之nsswitch-名词解析）"><a href="#11-Linux认证之nsswitch-名词解析）" class="headerlink" title="11 Linux认证之nsswitch(名词解析）"></a><strong>11 Linux认证之nsswitch(名词解析）</strong></h2><p>认证机制:<br>3A认证:<br>认证机制:authentication(资源申请者证明自己本身的一个过程)<br>授权机制:authorization(用户是否可以访问一个服务或文件,用户访问服务或文件的能力)<br>审计机制:audition</p>
<p>root a.txt rw-<br>login:user_name:passwd </p>
<p>vi /etc/nsswitch.conf,该配置文件中规定了名称解析的地址文件顺序，其名词解析库位于lib64中</p>
<p>###11.1 什么是nsswithch.conf(服务搜索顺序)文件<br>nsswitch.conf(name service switch configuration,名字服务切换配置)文件位于/etc目录下,由它规定通过哪些途径以及按照什么顺序以及通过这些途径来查找特定类型的信息,还可以指定某个方法奏效或失效时系统将采取什么动作。<br>     Nsswitch.conf中的每一行配置都指明了如何搜索信息,每行配置的格式如下:<br>     Info: method[[action]] [method[[action]]…]<br>     其中,info指定该行所描述的信息的类型,method为用来查找该信息的方法,action是对前面的method返回状态的响应。action要放在方括号里。</p>
<p>###11.2 nsswitch.conf的工作原理<br>    当需要提供nsswitch.conf文件所描述的信息的时候,系统将检查含有适当info字段的配置行。它按照从左向右的顺序开始执行配置行中指定的方法。在默认情况下,如果找到期望的信息,系统将停止搜索。如果没有指定action,那么当某个方法未能返回结果时,系统就会尝试下一个动作。有可能搜索结束都没有找到想要的信息。</p>
<p>####11.2.1信息(Info)<br>    Nsswitch.conf文件通常控制着用户(在passwd中)、口令(在shadow中)、主机IP和组信息(在group中)的搜索。下面的列表描述了nsswitch.conf文件控制搜索的大多数信息(Info项)的类型。<br>automount:自动挂载(/etc/auto.master和/etc/auto.misc)<br>bootparams:无盘引导选项和其他引导选项(参见bootparam的手册页)<br>ethers:MAC地址<br>group:用户所在组(/etc/group),getgrent()函数使用该文件<br>hosts:主机名和主机号(/etc/hosts),gethostbyname()以及类似的函数使用该文件<br>networks:网络名及网络号(/etc/networks),getnetent()函数使用该文件<br>passwd:用户口令(/etc/passwd),getpwent()函数使用该文件<br>protocols:网络协议(/etc/protocols),getprotoent()函数使用该文件<br>publickey:NIS+及NFS所使用的secure_rpc的公开密钥<br>rpc:远程过程调用名及调用号(/etc/rpc),getrpcbyname()及类似函数使用该文件<br>services:网络服务(/etc/services),getservent()函数使用该文件<br>shadow:映射口令信息(/etc/shadow),getspnam()函数使用该文件<br>aiases:邮件别名,sendmail()函数使用该文件</p>
<p>####11.2.2方法(method)<br>下面列出了nsswich.conf文件控制搜索信息类型的方法,对于每一种信息类型,都可以指定下面的一种或多种方法:<br>files:搜索本地文件,如/etc/passwd和/etc/hosts<br>nis:搜索NIS数据库,nis还有一个别名,即yp<br>dns:查询DNS(只查询主机)<br>compat:passwd、group和shadow文件中的±语法</p>
<p>####11.2.3搜索顺序(从左至右)<br>两个或者更多方法所提供的信息可能会重叠。举例来说,files和nis可能都提供同一个用户的口令信息。如果出现信息重叠现象,就需要考虑将哪一种方法作为权威方法(优先考虑),并将该方法放在方法列表中靠左的位置上。<br>默认nsswitch.conf文件列出的方法并没有动作项,并假设没有信息重叠(正常情况)。在这种情况下,搜索顺序无关紧要:当一种方法失败之后,系统就会尝试下一种方法,只是时间上受到一点损失。如果在方法之间设置了动作,或者重叠的项的内容不同,那么搜索顺序就变得重要起来。<br>例如下面两行nsswitch.conf文件配置行:<br>passwd files nis<br>host nis files dns<br>第一行让系统在/etc/passwd文件中搜索口令信息,如果失败的话,就使用NIS来查找信息。如果正在查找的用户同时出现在这两个地方,就会使用本地文件中的信息,因此它就是权威信息。第二行先使用NIS搜索；如果失败的话,就搜索/etc/hosts文件；如果再次失败的话,核对DNS以找出主机信息。</p>
<p>####11.2.4动作项([action])<br>在每个方法后面都可以选择跟一个动作项,用来指定如果由于某种原因该方法成功抑或失败需要做些什么。动作项的格式如下:<br>[[!]STATUS =action]<br>其中,开头和末尾的方括号属于格式的一部分,并不是用来指出括号中的内容是可选的。STATUS(按照约定使用大写字母,但本身并不区分大小写)是待测试的状态,action是如果STATUS匹配前面的方法所返回的状态将要执行的动作。开头的感叹号(!)是可选的,其作用是将状态取反。<br>STATUS的取值如下:<br>NOTFOUND:方法已经执行,但是并没有找到待搜索的值。 默认的动作是continue。<br>SUCCESS:方法已经执行,并且已经找到待搜索的值,没有返回错误。默认动作是return。<br>UNAVAIL:方法失败,原因是永久不可用。举例来说,所需的文件不可访问或者所需的服务器可能停机。默认的动作是continue。<br>TRYAGAIN:方法失败,原因是临时不可用。举例来说,某个文件被锁定,或者某台服务器超载。默认动作是continue。<br>action的取值如下:<br>return:返回到调用例程,带有返回值,或者不带返回值。<br>continue:继续执行下一个方法。任何返回值都会被下一个方法找到的值覆盖。<br>示例:<br>举例来说,下面这行取自nsswitch.conf文件,它的作用是让系统首先使用DNS来搜索给定主机的IP地址。DNS方法后面的动作项是测试该方法所返回的状态是否为“非(!)UNAVAIL”。<br>hosts dns [!UNAVAIL=return] files<br>如果DNS方法没有返回UNAVAIL(!UNAVAIL),也就是说DNS返回SUCCESS、NOTFOUND或者TRYAGAIN,那么系统就会执行与该STATUS相关的动作(return)。其结果就是,只有在DNS服务器不可用的情况下才会使用后面的方法(files)。<br>如果DNS服务器并不是不可用(两次否定之后就是“可用”),那么搜索返回域名或者报告未找到域名。只有当服务器不可用的时候,搜索才会使用files方法(检查本地的/etc/hosts文件)。</p>
<p>####11.2.5compat方法:passwd、group和shadow文件中的”±”<br>可以在/etc/passwd、/etc/group和/etc/shadow文件中放入一些特殊的代码,(如果在nsswitch.conf文件中指定compat方法的话)让系统将本地文件和NIS映射表中的项进行合并和修改。<br>在这些文件中,如果在行首出现加号’＋’,就表示添加NIS信息；如果出现减号’－’,就表示删除信息。举例来说,要想使用passwd文件中的这些代码,可以在nsswitch.conf文件中指定passwd: compat。然后系统就会按照顺序搜寻passwd文件,当它遇到以+或者 开头的行时,就会添加或者删除适当的NIS项。<br>虽然可以在passwd文件的末尾放置加号,在nsswitch.conf文件中指定passwd: compat,以搜索本地的passwd文件,然后再搜寻NIS映射表,但是更高效的一种方法是在nsswitch.conf文件中添加passwd: file nis而不修改passwd文件。</p>
<h2 id="12-Linux认证之PAM"><a href="#12-Linux认证之PAM" class="headerlink" title="12 Linux认证之PAM"></a><strong>12 Linux认证之PAM</strong></h2><p>###12.1 PAM的Login模块<br>login（登陆过程，先解析后验证）:<br>①root–nsswitch.conf–passwd: files<br>②123–nsswitch.conf–shadow: files<br>③authentication:123–sha512(salt)–/etc/shadow compare<br>①和②由nsswitch到passwd和shadow中去查找，第三步交由PAM来处理，直接验证<br>nsswitch：files db nis ldap<br>authentication：files db nis ldap kerberos等</p>
<p>ldd:查看某个服务所支持的模块<br>语法:ldd service_path，与当前目录无关</p>
<p>authentication：当某个应用程序需要验证的时候，会需要一个中间的模块进行辅助验证，该模块即为PAM<br>PAM：嵌入式认证模块，PAM本身不会执行验证，需要借助一系列策略或模块来验证。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[root@localhost security]# ldd /usr/sbin/httpd | grep libpam </span><br><span class="line">[root@localhost security]# cd /etc/pam.d/</span><br><span class="line">在这个目录下的文件包含了验证信息，如果有标识的文件找不到的话，就会到other目录中去寻找认证。</span><br><span class="line">[root@localhost pam.d]# cat vsftpd</span><br><span class="line">[root@localhost pam.d]# cat other</span><br></pre></td></tr></table></figure></p>
<p>即：<br>/etc/pam.d/service_name(系统中支持pam认证的服务名称)<br>/etc/pam.d/other(当系统中支持pam认证的服务没有匹配到任何条目时,匹配other中的配置)</p>
<p>/etc/pam.d/service_name格式，<br>其文件内容<br>每一列表示的内容分别为<br>type类型  control控制标准 modules模块 [modules_args]模块的参数选项，可省略</p>
<p>####type类型<br>auth(entication):身份验证,匹配用户名和密码<br>account:检查用户名和密码的有效性<br>password:检查修改改密码时,密码是否符合标准<br>session:检查用户会话相关属性</p>
<p>####control<br>required:一票否决权,继续匹配下面的条目,最后不匹配(保护系统的安全性)<br>requisite:一票否决权,不匹配下面的条目,直接给用户返回结果<br>sufficient:一票同意权,不匹配下面的条目,直接给用户返回结果(慎用)<br>optional:不影响最终结果<br>include:引用其他的配置文件,把匹配权交给其他配置文件(如果其他配置跳出,则整个匹配结束)<br>substack:引用其他的配置,把匹配权交给其他配置文件(如果其他配置跳出,则仅仅跳出子匹配)</p>
<p>####modules:匹配认证模块<br>另外还有一种比较复杂的格式为value = action的语法来设置控制标志,标志之间会以空格分开.格式如下:<br><code>value1 = action1 value2 = action2 ……</code><br>     其中value可以是下列Linux PAM库的返回值:<br>success、open_err、symbol_err、service_err、 system_err、buf_err、perm_denied、auth_err、cred_insufficient、authinfo_unavail、user_unknown、maxtries、new_authtok_reqd、acct_expired、 session_err、cred_unavail、cred_expired、cred_err、no_module_data、conv_err、 authtok_err、authtok_recover_err、authtok_lock_busy、authtok_disable_aging、 try_again、ignore、abort、authtok_expired、module_unknown、bad_item和default.<br>最后一个(default)能够用来设置上面的返回值无法表达的行为.</p>
<p>required [success=ok new_authtok_reqd=ok ignore=ignore default=bad]<br>requisite [success=ok new_authtok_reqd=ok ignore=ignore default=die]<br>sufficient [success=done new_authtok_reqd=done default=ignore]<br>optional [success=ok new_authtok_reqd=ok default=ignore] </p>
<p>####action值<br>     ignore:忽略执行结果<br>     bad:如果失败,结果被用于整个执行栈,后续栈继续执行<br>     die:和bad相似,但是失败直接返回结果,后续栈不执行<br>     ok:如果PAM_SUCCESS覆盖之前值<br>     done:和ok 相似,但是栈直接返回结果<br>     reset:重置栈当前状态</p>
<p>###12.2 PAM的modules 认证模块<br>/etc/pam.d/<em>:每一个应用程序PAM配置文件<br>PAM模块真正存放的位置<br>/usr/lib64/security/</em>:PAM认证模块文件的实际存放位置<br>/etc/security/*:其他PAM环境的配置文件,比如 access.conf<br>/usr/share/doc/pam-x:存放详细的PAM的说明文件</p>
<p>反撇号直接引用命令结果</p>
<p>####modules:PAM认证模块<br>/etc/pam.d/<em>:每一个应用程序PAM配置文件<br>/usr/lib64/security/</em>:PAM认证模块文件的实际存放位置<br>/etc/security/*:其他PAM环境的配置文件,比如 access.conf<br>/usr/share/doc/pam-x:存放详细的PAM的说明文件</p>
<p>查看应用程序是否支持PAM认证<br>ldd app_path<br>如: ldd /usr/sbin/vsftpd | grep libpam</p>
<p>pam_env.so:设置环境变量的模块,如果需要额外的环境变量,可以使用pam_env.so进行设置,配置文件/etc/security/pam_env.conf </p>
<p>pam_unix.so:提供验证阶段的验证功能,也可以提供授权管理<br>pam_secruetty.so:限制系统管理员只能够从安全的终端登录,安全终端:/etc/securetty<br>pam_nologin.so:限制普通使用者能否登录主机进行使用,当/etc/nologin文件存在时,所有的普通用户都无法登录<br>pam_cracklib.so:可是限制恶意攻击,检查密码强度<br>pam_pwquality.so:完全兼容pam_cracklib.so,检查密码强度,包括设置的密码是否在字典<br>pam_limits.so:限制使用者打开文件数量,单个文件大小等<br>pam_rootok.so:如果UID为0,直接通过,如root用户su到普通用户使用此模块<br>pam_listfile.so:验证使用其他的文件<br>pam_access.so:控制访问的模块,默认配置/etc/security/access.conf</p>
<ul>
<li>: ALL EXCEPT gooann:ALL</li>
</ul>
<p>####ulimit:语法<br> ulimit [options] 限额<br>options:<br>-H:hard limit:严格的限制,必须不能超过这个设置的数值<br>-S:soft limit:警告的限制,超过这个数值系统会发出警告,通常soft比hard小<br>-a:后面不加任何选项,可以列出系统中所有的限制额度<br>-c:当某个用户程序发生错误的时候,系统会将内存中的应用程序写成文件,这种文件成为核心文件(core file),限制每个核心文件的最大容量<br>-f:此shell可以创建的文件的大小,单位kb<br>-l:可以锁定的内存量<br>-u:单一用户可以使用的最大的进程量<br>-t:可以使用的最大的CPU时间</p>
<p>####limits配置文件<br>/etc/security/limits.conf<br>配置文件格式</p>
<p><domain> <type> <item> <value><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">domain:可以是用户,组或*,*代表所有限制</span><br><span class="line">type:soft(软限制) hard(硬限制)</span><br><span class="line">item:</span><br><span class="line">- core - limits the core file size (KB)</span><br><span class="line">- data - max data size (KB)</span><br><span class="line">- fsize - maximum filesize (KB)</span><br><span class="line">- memlock - max locked-in-memory address space (KB)</span><br><span class="line">- nofile - max number of open file descriptors</span><br><span class="line">- rss - max resident set size (KB)</span><br><span class="line">- stack - max stack size (KB)</span><br><span class="line">- cpu - max CPU time (MIN)</span><br><span class="line">- nproc - max number of processes</span><br><span class="line">- as - address space limit (KB)</span><br><span class="line">- maxlogins - max number of logins for this user</span><br><span class="line">- maxsyslogins - max number of logins on the system</span><br><span class="line">- priority - the priority to run user process with</span><br><span class="line">- locks - max number of file locks the user can hold</span><br><span class="line">- sigpending - max number of pending signals</span><br><span class="line">- msgqueue - max memory used by POSIX message queues (bytes)</span><br><span class="line">- nice - max nice priority allowed to raise to values: [-20, 19]</span><br></pre></td></tr></table></figure></value></item></type></domain></p>
<p>value:限制的具体数值</p>
<p>试验:使用pam认证模块限制sshd登录用户(pam_listfile.so)</p>
<p>只允许root和gooann组的用户可以登录</p>
<p>locate find tar gzip bzip tree stat install du df uname less more date clock hwclock</p>

      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/Linux/" rel="tag"># Linux</a>
          
        </div>
      

      
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/08/Star/" rel="next" title="Star">
                <i class="fa fa-chevron-left"></i> Star
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image"
                src="/images/site-author-image.jpg"
                alt="Lollipop" />
            
              <p class="site-author-name" itemprop="name">Lollipop</p>
              <p class="site-description motion-element" itemprop="description">攻城狮基地</p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">日志</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-categories">
                <a href="/categories/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">分类</span>
                </a>
              </div>
            

            
              
              
              <div class="site-state-item site-state-tags">
                <a href="/tags/index.html">
                  <span class="site-state-item-count">2</span>
                  <span class="site-state-item-name">标签</span>
                </a>
              </div>
            

          </nav>

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          

          
          

          
          

          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#（一）Linux入门（常见命令-用户权限与管理等）"><span class="nav-number">1.</span> <span class="nav-text">（一）Linux入门（常见命令 用户权限与管理等）</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-虚拟机的使用"><span class="nav-number">1.1.</span> <span class="nav-text">1 虚拟机的使用</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-操作系统概念"><span class="nav-number">1.2.</span> <span class="nav-text">2 操作系统概念</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-Linux设计哲学思想"><span class="nav-number">1.3.</span> <span class="nav-text">3 Linux设计哲学思想</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-高效获取命令帮助信息"><span class="nav-number">1.4.</span> <span class="nav-text">4 高效获取命令帮助信息</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-Linux根文件系统"><span class="nav-number">1.5.</span> <span class="nav-text">5 Linux根文件系统</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-Linux-常见命令"><span class="nav-number">1.6.</span> <span class="nav-text">6 Linux 常见命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#mv-move"><span class="nav-number">1.6.1.</span> <span class="nav-text">mv: move</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-Shell特性"><span class="nav-number">1.7.</span> <span class="nav-text">7 Shell特性</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-用户"><span class="nav-number">1.8.</span> <span class="nav-text">8 用户</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-用户管理命令"><span class="nav-number">1.9.</span> <span class="nav-text">9 用户管理命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#用户管理"><span class="nav-number">1.9.1.</span> <span class="nav-text">用户管理:</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-Linux权限"><span class="nav-number">1.10.</span> <span class="nav-text">10 Linux权限</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-Linux认证之nsswitch-名词解析）"><span class="nav-number">1.11.</span> <span class="nav-text">11 Linux认证之nsswitch(名词解析）</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-Linux认证之PAM"><span class="nav-number">1.12.</span> <span class="nav-text">12 Linux认证之PAM</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Lollipop</span>

  
</div>


  <div class="powered-by">由 <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a> 强力驱动</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">主题 &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.4"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.4"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.4.js"></script>
  <script>AV.initialize("ldUNxUKn3KNISnmg5lHGMOmP-gzGzoHsz", "QarL9yvYtqTnsr959YPDYA0a");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  

  
  

  

  

  

</body>
</html>
